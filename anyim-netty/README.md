# netty
## 大致思路
- netty定位是提供长连接通道
- netty对接agw，在agw处认证wss，同时还可以做负载均衡，省去了TRS的逻辑
- 消息模式采用推拉式，长连接在线场时推下去，不在线时下次登录自动拉去
- 不管消息能不能推下去，都要发给MQ给Chat去把消息入库和入Redis
- 单聊表和群聊表类似，都是通过fromid+toid/groupid来区分，msgid在fromid+toid/groupid下是单调递增的，可以不连续，如果给组合主键上面加一个单调递增的ID列？
- 产生消息时，同步写DB和Redis（先写DB，再写Redis，可以试一下能不能放在一个事务方法里面），Redis缓存7天，DB永久保存
- 客户端拉去消息时，传递上次更新时间，上次更新的最后一个msgid，如果上次更新时间在7天内，直接从Redis拉取，否则从DB拉取（不同时拉去Redis和数据库）
- 账号退出时，websocket通道要关闭，可以通过user发送mq事件来监听到
